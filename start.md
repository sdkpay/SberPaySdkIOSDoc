# [SberPaySdkIOSDoc](https://sdkpay.github.io/SberPaySdkIOSDoc)

# Начало работы
> Xcode 13+
> Версия iOS 13.0 и более поздние

## Подключение SDK к проекту

### Настройка info.plist
Для корректной работы SDK в файле **info.plist** приложения должны быть добавлены следующие параметры
```
<key>DTXAutoStart</key>
<string>false</string>
<key>NSAppTransportSecurity</key>
<dict>
  <key>NSExceptionDomains</key>
  <dict>
    <key>gate1.spaymentsplus.ru</key>
    <dict>
      <key>NSExceptionAllowsInsecureHTTPLoads</key>
      <true/>
    </dict>
    <key>ift.gate2.spaymentsplus.ru</key>
    <dict>
      <key>NSExceptionAllowsInsecureHTTPLoads</key>
      <true/>
    </dict>
  </dict>
</dict>
<key>NSFaceIDUsageDescription</key>
<string>Так вы подтвердите, что именно вы выполняете вход</string>
<key>NSLocationWhenInUseUsageDescription</key>
<string>Данные о местонахождении собираются и отправляются на сервер для безопасного проведения оплаты</string>
```
> NSLocationWhenInUseUsageDescription - Если у вас уже используется этот параметр, то дублировать его не нужно

### SPM
Перейдите в файл вашего проекта, во вкладке *Package dependencies* нажмите *+* и в строке поиска введите ссылку на репозиторий, переданную вам с договором, и добавьте пакет SDK в свое приложение

### Cocoapods
Для подключения SDK к проекту с помощью cocoapods:
  1. Откройте свой проект в Xcode
  2. Создайте подфайл, запустив `pod init` в терминале или используя меню *File* и выбрав *New File → Podfile*.
  3. Добавьте модули, которые вы хотите использовать, в файл **Podfile**.
  4. Сохраните Podfile и запустите `pod install` в Терминале, чтобы установить модули.
  5. Закройте свой проект в Xcode и откройте файл **.xcworkspace**, созданный после запуска `pod install`.

### Бинарный артефакт
Подключить SDK для успешной работы также можно с помощью [бинарного артефакта](https://github.com/sdkpay/EcomSdkPackage). Перетащите скачанный файл **EcomSdk.xcframework** в *Frameworks, Libraries, and Embedded Content*, а также выставите у зависимости параметр *Embed & Sign*

### Регистрация deeplink
Для успешной авторизации в среде банка необходим *диплинк*, переданный вам с приветственным письмом. Если вы выпускаете еще одно приложение и публикуете его отдельно - необходимо запросить и получить отдельный диплинк. Если вы используете для нового приложения тот же самый диплинк, при оплате сбол не сможет выбрать нужное приложение для завершения сценария. При добавлении зарегистрированного *диплинка* в **info.plist** пожалуйста убедитесь, что в его составе отсутствует подстрока *://spay*

Выданный Вам диплинк нужно зарегистрировать в файле вашего проекта. Во вкладке *info* необходимо добавить его в раздел *Url types*

## Начало работы
Импортируйте модуль SPaySdk в проект

### Swift
```
import SPaySdk
```

### Objective-C
```
#import <SPaySdk/SPaySdk.h>
```

В AppDelegate вашего проекта в методе `didFinishLaunchingWithOptions` необходимо реализовать функцию `setup`. Параметры функции представлены [здесь](https://sdkpay.github.io/EcomSdkIOSDoc/data_structures#ecomsdksetupData)

> Если вы подключили сервис *Плати частями* и пользователь выбрал этот способ для оплаты заказа, то выполняя через back расширенный запрос состояния заказа *getOderStatusExtended.do*, в ответе вы получите значение параметра *paymentWay* равное *BNPL*. Подключить параметр *paymentWay* в callback-уведомлениях возможно в личном кабинете партнера интернет-эквайринга. Это можно сделать в **настройках -> основные настройки -> callback-уведомления**. При заполнении доп. параметров выйдет список всех возможных. Для того, чтобы передавался способ оплаты заказа необходимо выбрать *paymentWay*.  
> Оплаченные частями заказы в личном кабинете партнера интернет-эквайринга будут отмечаться признаком *BNPL* в поле «Платежное средство»  
> При этом денежные средства по заказам, оплаченным частями, поступят от ООО «ЦНФС» («Центр новых финансовых сервисов»), предоставляющей сервис

